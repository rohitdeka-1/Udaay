#!/bin/bash
# Manual deployment fix script - Run this on the VM to fix the .env issue

echo "Creating .env file with all required environment variables..."

cat > ~/lakecity/.env << 'ENVEOF'
MONGO_URI=mongodb+srv://bstippusultan_db_user:Dhaliwal%4012@cluster0.quroscl.mongodb.net/?retryWrites=true&w=majority&appName=Cluster0
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production-please-make-it-long-and-random
GOOGLE_MAPS_API_KEY=AIzaSyCfLUe8Zr8pL4YfP2pdKYAPUrbK7mLz9qw
GOOGLE_CLOUD_PROJECT_ID=adroit-lock-485008-d6
GOOGLE_CLOUD_BUCKET_NAME=lakecity-uploads
GEMINI_PROJECT_ID=adroit-lock-485008-d6
GEMINI_LOCATION=us-central1
GEMINI_MODEL=gemini-1.5-flash-002
INTERNAL_JWT_SECRET=internal-service-jwt-secret-for-spring-boot-communication
FIREBASE_PROJECT_ID=lakecity-cb44b
FIREBASE_PRIVATE_KEY_ID=e6c47d671a5d7d6dfb31ebb1eaaf33cbb63f015d
FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDcvpfGEqQd0Vq7
gHSuHIXs3M+A9+TBd2hDdDyWYMGG7wKQtxR+vMH/I3K23gOPZxc0qKfZJ5cZJzp/
Z9hYSJTq2QaOZNO4YN+wFmYvJKXF8F3wT4pTXtP+9Y5XN7Dz9y0B9H5K4J5sQg6L
lhPH1T3k0fZqP+6hV1mE6R0oZfNJXp1fSfGxvW8T2D6wKWcJ6YvU4vF+9qJ7vR8N
e3F2E5bP7M8H0L1Y3S1T8V9H0dZ1P7aF5H5F8Y6S1Q3P8N8V1Z5M6T3W9J4L3V0R
Q6H9W7X1X0P2W4J5L0H3Y1F6H0Q3V1Z2X2S9V3M4H5Y0X6W1T7H3Y1X2Q8H0V1Z3
jx3cG6H1AgMBAAECggEABFzLUu0s1UKbV+qqN9wdZ5z8ZqP6xF7YbdpQnQg5KH0D
j3xH+5L8X6H7J1Y2K3Z0M4H5V6L7X8P9Q0R1S2T3U4V5W6X7Y8Z9A0B1C2D3E4F5
vJ9dLgH3X7jP0Q3V1R2S3T4U5V6W7X8Y9Z0A1B2C3D4E5F6G7H8I9J0K1L2M3N4O5
P6Q7R8S9T0U1V2W3X4Y5Z6A7B8C9D0E1F2G3H4I5J6K7L8M9N0O1P2Q3R4S5T6U7V8
W9X0Y1Z2A3B4C5D6E7F8G9H0I1J2K3L4M5N6O7P8Q9R0S1T2U3V4W5X6Y7Z8A9B0C1
D2E3F4G5H6I7J8K9L0M1N2O3P4Q5R6S7T8U9V0W1X2Y3Z4A5B6C7D8E9F0G1H2I3J4
K5L6M7N8O9P0Q1R2S3T4QKBgQD6t8Z9H0J1K2L3M4N5O6P7Q8R9S0T1U2V3W4X5Y6
Z7A8B9C0D1E2F3G4H5I6J7K8L9M0N1O2P3Q4R5S6T7U8V9W0X1Y2Z3A4B5C6D7E8F9
G0H1I2J3K4L5M6N7O8P9Q0R1S2T3U4V5W6X7Y8Z9A0B1C2D3E4F5G6H7I8J9K0L1M2
N3O4P5Q6R7S8T9U0V1W2X3Y4Z5wKBgQDhJ3K4L5M6N7O8P9Q0R1S2T3U4V5W6X7Y8
Z9A0B1C2D3E4F5G6H7I8J9K0L1M2N3O4P5Q6R7S8T9U0V1W2X3Y4Z5A6B7C8D9E0F1
G2H3I4J5K6L7M8N9O0P1Q2R3S4T5U6V7W8X9Y0Z1A2B3C4D5E6F7G8H9I0J1K2L3M4
N5O6P7Q8R9S0T1U2V3W4X5Y6Z7A8B9wKBgElmZMz2K3L4M5N6O7P8Q9R0S1T2U3V4
W5X6Y7Z8A9B0C1D2E3F4G5H6I7J8K9L0M1N2O3P4Q5R6S7T8U9V0W1X2Y3Z4A5B6C7
D8E9F0G1H2I3J4K5L6M7N8O9P0Q1R2S3T4U5V6W7X8Y9Z0A1B2C3D4E5F6G7H8I9J0
K1L2M3N4O5P6Q7R8S9T0U1V2W3X4AoGBAL3M4N5O6P7Q8R9S0T1U2V3W4X5Y6Z7A8
B9C0D1E2F3G4H5I6J7K8L9M0N1O2P3Q4R5S6T7U8V9W0X1Y2Z3A4B5C6D7E8F9G0H1
I2J3K4L5M6N7O8P9Q0R1S2T3U4V5W6X7Y8Z9A0B1C2D3E4F5G6H7I8J9K0L1M2N3O4
P5Q6R7S8T9U0V1W2X3Y4Z5A6B7C8D9AoGAI4J5K6L7M8N9O0P1Q2R3S4T5U6V7W8
X9Y0Z1A2B3C4D5E6F7G8H9I0J1K2L3M4N5O6P7Q8R9S0T1U2V3W4X5Y6Z7A8B9C0D1
E2F3G4H5I6J7K8L9M0N1O2P3Q4R5S6T7U8V9W0X1Y2Z3A4B5C6D7E8F9G0H1I2J3K4
L5M6N7O8P9Q0R1S2T3U4V5W6X7Y8Z9A0=
-----END PRIVATE KEY-----"
FIREBASE_CLIENT_EMAIL=firebase-adminsdk-fbsvc@lakecity-cb44b.iam.gserviceaccount.com
FIREBASE_CLIENT_ID=113321684144680109739
FIREBASE_CERT_URL=https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-fbsvc%40lakecity-cb44b.iam.gserviceaccount.com
ENVEOF

echo "✅ .env file created"
echo ""
echo "Restarting containers..."
cd ~/lakecity
docker-compose down
docker-compose up -d

echo ""
echo "✅ Deployment fixed! Waiting 10 seconds for services to start..."
sleep 10

echo ""
echo "Container status:"
docker-compose ps

echo ""
echo "Testing backend health:"
curl http://localhost:8080/health

echo ""
echo "✅ Done! Check the logs with: docker-compose logs -f server"
